const documentChecklist = [
  {
    name: 'Tier 5 Creative and Sporting',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 5 Government Authorised Exchange',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 2 Intra-company Transfer',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Family (needs expanding)',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Global Talent',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Innovator',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Startup',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 1 Investor',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 2 General Work',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 2 Minister of Religion',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 2 Sportsperson',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 4 General Student',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 4 Short Term Study',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 5 Charity Worker',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 5 International Agreement',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 5 Religious Worker',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 5 Seasonal Worker',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 5 Youth Mobility Scheme',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  },
  {
    name: 'Tier 4 Child Student',
    checklist: [
      { 
        label: 'Current passport (or travel documentation with blank page)',
        checked: false
      },
      { 
        label: 'TB test results',
        checked: false
      },
      { 
        label: "Criminal record certificate (from any country you've been in for longer than 12 months in the last 10 years)",
        checked: false
      }
    ]
  }
]

// The Cloud Functions for Firebase SDK to create Cloud Functions and setup triggers.
const functions = require('firebase-functions');
// The Firebase Admin SDK to access the Firebase Realtime Database.
const admin = require('firebase-admin');
admin.initializeApp();
const db = admin.firestore();
// This function will be called when a document is added to questionnaireResults collection
exports.addResultsToProfile = functions.firestore
  .document('questionnaireResults/{resultsId}')
  .onCreate((change, context) => {
    const addedResults = change.data(); // change.data() = access data from the questionnaireResults
    const result = {...addedResults};
    result.id = context.params.resultsId;
    // Get document checklist and name for favorite visa
    const favoriteVisa = documentChecklist.filter(item => item.name === result.recommendedVisa[0]);
    db.collection('profiles')
      .doc(addedResults.user.id)
      .update({
        questionnaireResults: admin.firestore.FieldValue.arrayUnion(result),
        favoriteVisa: favoriteVisa[0]
      })
  })
